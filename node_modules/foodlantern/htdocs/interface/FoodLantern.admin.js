var FoodLantern;

(function () {
    "use strict";

    FoodLantern = function () {
        
        var self = this;
        
        this.server = null;
        
        this.games = {};
        
        this.currentGame = null;
        
        this.settings = {
            domain : 'http://cttoronto.cloudapp.net'
        };
        
        this.domElements = {};
        
        this.initialize = function () {
            return new Promise(function (resolve, reject) {
            
                self.domElements.gamesList = document.getElementById('gamesList').querySelector('tbody');
                self.domElements.
                
                resolve();
            });
        };
        
        self.connectToServer = function () {
            console.log('connecting to server');
            return new Promise(function (resolve, reject){
                self.server = io.connect(self.settings.domain);
                self.setupListeners();
                resolve();
            });
        };
        
        this.setupListeners = function () {
            console.log('setting up listeners');
            self.server.on('handshake', self.introduceSelf);
            self.server.on('gamesList', self.receivedGamesList);
        };
        
        this.introduceSelf = function () {
            console.log('Introducting myself');
            self.server.emit('handshake', {
                roll : 'admin'
            });
        };
        
        this.receivedGamesList = function (gamesList) {
            var i;
            for (i = 0; i < gamesList.length; i += 1) {
                self.addNewGame(gamesList[i]);
            }
            
            var currentGame = gamesList[0];
            
            self.activateGameData();
            
        };
        
        this.activateGameData = function () {
            
        };
        
        this.addNewGame = function (gameObj) {
            
            var gameDom = {},
                spinner;
            
            if (self.games[gameObj._id]) return true;
            
            if (spinner = self.domElements.gamesList.querySelector('.loadingSpinner')) {
                spinner.parentNode.removeChild(spinner);
            }
            
            gameDom.row = document.createElement('tr');
            gameDom.name = document.createElement('td');
            gameDom.playerCount = document.createElement('td');
            
            gameDom.row.appendChild(gameDom.name);
            gameDom.row.appendChild(gameDom.playerCount);
            
            gameDom.name.textContent = gameObj.name;
            gameDom.playerCount.textContent = gameObj.players.length;
            
            self.domElements.gamesList.appendChild(gameDom.row);
            
        }
        
        this.initialize()
            .then(this.connectToServer, console.log);
        
    };
    
    FoodLantern = new FoodLantern();
    
}());